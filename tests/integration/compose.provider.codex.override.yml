services:
  agent:
    environment:
      - LUX_PROVIDER=codex
      - LUX_AUTH_MODE=host_state
      - LUX_PROVIDER_MOUNT_HOST_STATE_IN_API_MODE=false
      - LUX_PROVIDER_SECRETS_FILE=
      - LUX_PROVIDER_ENV_KEY=OPENAI_API_KEY
      - LUX_PROVIDER_HOST_STATE_COUNT=2
      - LUX_PROVIDER_HOST_STATE_SRC_0=/run/lux/provider_host_state/0
      - LUX_PROVIDER_HOST_STATE_DST_0=/home/agent/.codex/auth.json
      - LUX_PROVIDER_HOST_STATE_SRC_1=/run/lux/provider_host_state/1
      - LUX_PROVIDER_HOST_STATE_DST_1=/home/agent/.codex/skills
    volumes:
      - ${HOME}/.codex/auth.json:/run/lux/provider_host_state/0:ro
      - ${HOME}/.codex/skills:/run/lux/provider_host_state/1:ro

  harness:
    environment:
      - HARNESS_TUI_CMD=codex -C /work -s danger-full-access
